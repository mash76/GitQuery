<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>GitQuery</title>
    <link href="./style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>

    <!-- header -->

    <div class="underline" style="padding:3px;">
      <table width="100%" style="padding:0px;margin:0px;">
        <tr>
          <td width="50%" valign="top" >
            <span id="version" class="gray s80" >**version**</span>
            <span onClick="toggleDevTools()" class="btn s80" >devTools</span>
            <span onClick="$('#nodejs_info').slideToggle(10)" class="btn s80" >node-<span id="node_version"></span></span>
            <span onClick="toggleFullScreen()" class="btn s80" >fullScreen</span>

          </td>
          <td width="50%" align="right" >
            <span id="g_user" class="gray s80" ></span>
            <span onClick="$('#gitconf').toggle();" class="btn s80"> ~/.gitconfig ~/.gitignore_global</span>
          </td>
        </tr>
      </table>

      <div id="nodejs_info" class="detail hide"></div>
      <div id="gitconf" class="hide code detail" style="text-align:left;"></div>

      <div class="m5">
          <span onClick="togglePaneLocalRepoList()" class="btn bold s120" >Repositories</span>
          <span onClick="$('#gitinit_pane').slideToggle(10);" class="btn" >init</span>
          <span onClick="$('#gitclone_pane').slideToggle(10);" class="btn" >clone</span>
          <span id="his_repo"></span>
      </div>

    </div>



    <div id="gitinit_pane" class="detail hide">
        init<br/>
        <input id="init_path" type="text" placeholder="init_path" />
        <input id="init_name" type="text" placeholder="project_name" />
        <button onClick="osRunOut('git remote add  \'' + $('#remote_name').val() + '\' \'' + $('#remote_url').val() +'\'')" />add</button>
    </div>

    <div id="gitclone_pane" class="detail hide">
        git crone from remote<br/>
        <input id="gitclone_dir"  type="text" size=50 placeholder="clone_dir" />
        <input id="gitclone_name" type="text" size=20 placeholder="clone_name" /><br/>
        <input id="gitclone_url"  type="text" size=80 placeholder="clone_url" />
        <br/>
                <button onClick="osRunOut('git clone add  \'' + $('#remote_name').val() + '\' \'' + $('#remote_url').val() +'\'')" />clone</button>
        <br/>
    </div>

    <!-- list : local repositories -->

    <div id="local_repo_pane" class="detail" >
      <input type="text" id="filter_l_repo" size=20 />
      <div id="local_repo_list"></div>
    </div>

    <!-- current repository  -->

    <div id="repo_info" class="m10 hide">
        <span id="current_repo_name" class="bold s170">**current_repo**</span>
        <span id="current_repo_path" class="gray">**current_repo_path**</span>
        <span onClick="osrun('open ' + path2dir(current_repo_path) )"  class="btn s80">finder</span>

        <span onClick="osRunOut('git fetch','pane_remote'); openPaneCenter('pane_remote')" class="btn s120">fetch</span>
        <span onClick="osRunOut('git pull','pane_remote'); openPaneCenter('pane_remote')" class="btn s120">pull</span>
        <span onClick="osRunOut('git push','pane_remote'); openPaneCenter('pane_remote')" class="btn s120">push</span>

        <br/>

        <span onClick="showBranchList()" >
          <span class="btn">branch</span><span id="local_branch_ct" class="btn s120 bold">**local_branch_ct**</span>
        </span>

        <span onClick="showIgnore()" class="btn">.gitignore</span>
        <span onClick="osrun('ls ' + current_repo_path + '/hooks','repo_out'); togglePaneCurrentRepoDesc('hooks')" class="btn">hooks</span>
        <span onClick="osrun('git submodule status','repo_out'); togglePaneCurrentRepoDesc('hooks')" class="btn">submodule</span>

        <span onClick="showGitmodules()" class="btn">.gitmodules</span>

        <span onClick="osrun('git stash list','repo_out'); togglePaneCurrentRepoDesc('stash')" class="btn">stash</span>
        <span onClick="osrun('cat ' + current_repo_path + '/config','repo_out'); togglePaneCurrentRepoDesc('config')" class="btn">config</span>


        Remote
        <span onClick="osrun('git remote -v','repo_out'); togglePaneCurrentRepoDesc('remote')" class="btn">repo</span>

        <span onClick="osrun('git branch -r','repo_out'); togglePaneCurrentRepoDesc('remotebranch')" >
          <span class="btn">branch</span><span id="remote_branch_ct" class="btn s120 bold">**remote_branch_ct**</span>
        </span>

        <br/>

        <div id="repo_out" class="code hide detail" >repo_out</div>

        <!-- current branch -->

        <span id="c_branch" class="s170 bold">**c_branch**</span>

          <a href="javascript:void(0)" onClick="makePaneFilelist(''); openPaneCenter('pane_filelist');" >
            files<span id="br_files_ct" class="bold s150">**br_files_ct**</span>
          </a>
          <a href="javascript:void(0)" onClick="makePaneLog('') " >
            commit<span id="br_commit_ct" class="bold s150">**br_commit_ct**</span>
          </a>

           <span id="latest_commit" class="s80 gray">97f809b  4 minutes ago </span>

           <a href="javascript:void(0)" onClick="makePaneUser(''); openPaneCenter('pane_user');" >
             comitter<span id="br_member_ct" class="bold s150">**br_member_ct**</span>
           </a>
        <br/>

        <span onClick="makePaneStatus()"  class="btn">status</span>

        <span onClick="osRunOut('git diff ','pane_status_detail'); openPaneCenter('pane_status'); "  class="btn ">diff</span>
        <span onClick="openPaneCenter('pane_gitcommand'); $('#git_usercommand').focus() "  class="btn ">git_command</span>

        <span onClick="osRunOut('git log --graph --oneline ','pane_diff_detail')" class="btn s80">tree1</span>

        <div id="pane_gitcommand" pane="center" class="detail code">
            <input id="git_usercommand" type="text" size="70" placeholder="git command" />
            <button onClick="osRunOut($('#git_usercommand').val(),'pane_gitcommand_detail')" placeholder="git command" />run</button>
            <br/>
            <div id="pane_gitcommand_detail"></div>
        </div>




        <div id="pane_remote" pane="center" class="detail code">
          pane_remote
        </div>

        <div id="pane_status" pane="center" class="detail code">
          <span onClick="osRunOut('git add .','pane_status_detail'); openPaneCenter('pane_status'); "  class="btn s150">add</span>
          <span onClick="osRunOut('git reset','pane_status_detail'); openPaneCenter('pane_status'); "  class="btn s150">reset</span>
          <div id="pane_status_detail"></div>
        </div>

        <div id="pane_file" pane="center" class="detail code">
            <input type="text" id="filter_file" value="" size=10 >
            <div id="pane_file_detail_1" >  </div>
            <div id="pane_file_detail_2" >  </div>
        </div>

        <div id="pane_filelist" pane="center" class="detail code">
                <table ><tr><td valign=top >
                    Dir<br/>
                    <span id="pane_filelist_detail" >   </span>
                </td><td valign=top >
                      File<br/>
                      <input type="text" id="filter_filelist" value="" size=10 >

                      <span class="s80 gray">RecentCommit</span>

                      <span onClick="makePaneFilelist( $('#filter_filelist').val() , 'git diff HEAD~5 HEAD --name-only ')" class="btn ">〜5c</span>
                      <span onClick="makePaneFilelist( $('#filter_filelist').val() , 'git diff HEAD~10 HEAD --name-only ')" class="btn ">10c</span>
                      <span onClick="makePaneFilelist( $('#filter_filelist').val() , 'git diff HEAD~30 HEAD --name-only ')" class="btn ">30c</span>
                      <span onClick="makePaneFilelist( $('#filter_filelist').val() , 'git diff HEAD~100 HEAD --name-only ')" class="btn ">100c</span>
                      <br/>

                      <span id="pane_filelist_detail_r" >  </span>
                </td></tr></table>
        </div>

        <div id="pane_diff" pane="center" class="detail code">
          <input type="text" id="filter_diff" value="" size=10 >
          <div id="pane_diff_detail"></div>
        </div>

        <div id="pane_log" pane="center" class="detail code">
            <input type="text" id="filter_log" value="" size=10 >
            <div id="pane_log_detail"></div>

        </div>

        <div id="pane_user" pane="center" class="detail code">
            <input type="text" id="filter_user" value="" size=10 >
            <div id="pane_user_detail"></div>
        </div>

        <div id="pane_commit" pane="center" class="detail code">

        </div>

        <div class="m10">
            current repo info
            <span onClick="findLocalRepos()" class="btn s80">files</span>
            <div id="c_repo_info" class="underline s80"> </div>

            <span onClick="$('div[name=file_detail]').toggle();" class="btn">toggle</span>
            btn
            <br/>
            <span id="c_repo_pane" >c_repo_pane</span>
        </div>

        <br/><br/>
        <div id="real_files"></div>

        <div id="os_out" style="font-size:60%;font-color:silver;"></div>



        <br/>


        stash <span class="silver s80">git stash comment01  </span><br/>
        <input id="stash_comment" type="text" placeholder="remote_name" />
        <button onClick="osrun('git stash \'' + $('#stash_comment').val() + '\'')" placeholder="git command" />add</button>
        <br/>
        new remote <span class="silver s80">git remote add branchname01 https://..../.git   </span><br/>
        <input id="remote_name" type="text" placeholder="remote_name" />
        <input id="remote_url" type="text" placeholder="remote_url" />
        <button onClick="osrun('git remote add  \'' + $('#remote_name').val() + '\' \'' + $('#remote_url').val() +'\'')" placeholder="git command" />add</button>
        <br/>
        new sub module <span class="silver s80">git submodule add submodulename01 https://..../.git   </span><br/>
        <input id="submodule_path" type="text" placeholder="submodule_path" />
        <input id="dir_name" type="text" placeholder="dir_name" />
        <br/>
        new local branch <span class="silver s80">git branch branchname01 </span><br/>
        <input id="new_branch_name" type="text" placeholder="branch name" />
        <button onClick="osrun('git branch ' + $('#new_branch_name').val())" placeholder="git command" />add</button>
        <br/>
        commit<br/>
        <input id="commit_msg" type="text" placeholder="commit_msg name" />
        <button onClick="osRunOut('git commit -m \'' + $('#commit_msg').val() + '\'','pane_status')" placeholder="git command" />add</button>
        <br/>
    </div>

  </body>

  <script>

    require('./renderer.js')
    require('./functions.js')

      window.jQuery = window.$ = require('./jquery-3.1.0.js')

      const BrowserWindow = require('electron').remote.BrowserWindow // windowオブジェクト
      const path = require('path')

      local_repos =[]
      local_files =[]
      his_repo =[] // リポジトリ選択履歴
      current_repo_path = ""
      interval_log_filter = null // 入力完了からログ検索までの秒数

      execOption = { encoding: 'utf8',
                        timeout: 0,
                        maxBuffer: 2000*1024,  //200*1024
                        killSignal: 'SIGTERM',
                        cwd: '',
                        env: null }


      repo_btn_prev_push = "" //リポジトリ以下の母tなで直前push したもの
      top_filtered_repo = ""

    // You can also require other files to run in this process







    showGitmodules = function(){
      var git_command = 'cat ' + path2dir( current_repo_path ) + '/.gitmodules'
      osRunCb(git_command,
        function(ret_ary){
          $('#repo_out').html(sRed(git_command) + " " + sGray(ret_ary.length) + '<br/>')
          $('#repo_out').append(ret_ary.join('<br/>'))

          togglePaneCurrentRepoDesc('gitmodule')
      })

    }

    showIgnore = function(){
      var git_command = 'cat .gitignore'
      osRunCb(git_command,
          function(ret_ary){
              $('#repo_out').html(sRed(git_command) + " " + sGray(ret_ary.length) + '<br/>' +
                                   ret_ary.join('<br/>'))
              togglePaneCurrentRepoDesc('ignore')
      })
    }
    showBranchList = function() {
        var git_command = 'git branch'
        osRunCb(git_command,function(ret_ary){
              $('#repo_out').html(sRed(git_command) + " " + sGray(ret_ary.length) + '<br/>' )
              for (var ind in ret_ary ){
                  var v1 = ret_ary[ind].trim()
                  $('#repo_out').append('<span onclick="checkOut(\'' + v1 + '\')" class="btn">' + v1 +'</span><br/>')
              }
              togglePaneCurrentRepoDesc('branch')
        })
    }



    togglePaneLocalRepoList = function (){
      if ($('#togglePaneLocalRepoList').css('display') == 'block' ){
          $('#togglePaneLocalRepoList').slideUp(10)
      }else{
          $('#local_repo_pane').slideDown(10)
          $('#filter_l_repo').val('')
          filterLocalRepos('')
          $('#filter_l_repo').focus()
      }
    }

    //個別のペーンを出す方式に
    togglePaneCurrentRepoDesc = function (key){
      //初回なら閉じる
      if (key == "") {
          $('#repo_out').slideUp(10)
          return
      }
      //開いてる項目を押したら閉じる
      if (repo_btn_prev_push == key && $('#repo_out').css('display') == 'block' ){
          $('#repo_out').slideUp(10)
      }else{
          $('#repo_out').slideDown(10)
      }
      repo_btn_prev_push=key
    }

    diffColor = function (ary){
        for (var ind in ary){
          var line = ary[ind]
          //line = escapeHTML(line)
           if (line[0]=='-') ary[ind] = sBlue(line)
           if (line[0]=='+') ary[ind] = sGreen(line)

        }
        return ary
    }



    setCurrentBranchName = function(){
        osRunCb('git branch',function(ret_ary){
            for (var ind in ret_ary){
                if (ret_ary[ind].match(/\*/)){
                    $('#c_branch').html(ret_ary[ind].replace("*","").trim())
                }
            }
        })
    }

    checkOut = function ( branch_name ){
        osRunCb("git checkout '" + branch_name+ "'",
                  function(ret_ary){
                      console.log(ret_ary.join('<br/>'))
                      setRepoPath(current_repo_path)
                  })
    }

    findLocalRepos = function(){
      osRunCb("find ~ -type d -maxdepth 5 | egrep '/\.git$' ",
        function( ret_ary ){

            local_repos = ret_ary
            togglePaneLocalRepoList()
            filterLocalRepos('')
        }
      )
    }
    filterLocalRepos = function (filter){

      $('#local_repo_list').html("<table>");
      top_filtered_repo =""
      for (var ind in local_repos){
          var full_path = local_repos[ind]
          fname = path2pjname(full_path)
          fname_disp = fname

          if (filter) {

              var re = new RegExp('('+filter+')','i')
              if (!fname.match(re)) continue;

              if (!top_filtered_repo) top_filtered_repo = full_path
              fname_disp = fname_disp.replace(re,sRed('$1'))
          }
          $('#local_repo_list').prepend('<tr><td> <a href="javascript:void(0)" onClick="setRepoPath(\'' + full_path + '\')" class="btn s150">' +
                                    fname_disp + '</span> </td><td> &nbsp; ' + sGray(full_path.replace(fname,sGray2(fname)) ) + '</td></tr>')
      }
      $('#local_repo_list').append("</table>");

    }

    openPaneCenter = function( pane_name ){
      $('div[pane=center]').hide()
      $('#' + pane_name).slideDown(10)
    }


    // set local repository
    setRepoPath = function(full_path) {
        console.log(full_path)

        current_repo_path = full_path
        execOption.cwd = path2dir(current_repo_path)

        $('#current_repo_name').html( path2pjname(full_path) )
        $('#current_repo_path').html( full_path )
        $('#local_repo_pane').slideUp(10)

        his_repo[current_repo_path] = "";
        $('#his_repo').html("")
        for (var name in his_repo){
          $('#his_repo').append('<span onClick="setRepoPath(\'' + name + '\');" class="history s80">' + path2pjname(name) + '</span> ');
        }
        setCurrentBranchName()
        togglePaneCurrentRepoDesc("") // close

        osRunOneLine('git ls-files | wc -l', 'br_files_ct')
        osRunOneLine('git log --oneline | wc -l', 'br_commit_ct')
        //osRunOneLine('git log --date=relative --pretty=format:"%ad  : %h  : %an : %s" | head -1', 'latest_commit')
        osRunOneLine('git log --date=relative --pretty=format:"%ad" | head -1', 'latest_commit')
        osRunOneLine('git log --pretty=format:"%an" | sort | uniq | wc -l', 'br_member_ct')

        // local branch & remote branch
        osRunCb('git branch',function( ret_ary ){
            $('#local_branch_ct').html(ret_ary.length)
        })
        osRunCb('git branch -r',function( ret_ary ){
            $('#remote_branch_ct').html(ret_ary.length)
        })

        makePaneLog('')

        //ファイル一覧
        // osRunCb('ls ' + full_path ,
        //   function(ret_ary){
        //       $('#c_repo_pane').html("")
        //       for (var ind in ret_ary){
        //           file_disp = ret_ary[ind]
        //           var stat = fs.statSync(full_path + '/' + file_disp )
        //           if (stat.isDirectory()) file_disp = sBlue(file_disp)
        //           $('#c_repo_pane').append(file_disp + '<br/>')
        //
        //           if (stat.isFile()) {
        //               var ret = fs.readFileSync (full_path + '/' + file_disp)
        //               ret = ret.toString().substring(0,500).replace(/\n/g,'<br/>')
        //               $('#c_repo_pane').append('<div name="file_detail" class="m10 hide">' + s60(sSilver(ret)) + '</div>')
        //           }
        //       }
        //   }
        // )
        $('#repo_info').show() // 初回のrepo選択時は隠しているので


    }

    makePaneUser = function(filter){
        var git_command = 'git log --pretty=format:"%an" | sort | uniq -c | sort -r '
        if (filter) git_command += " | egrep -i '" + filter + "'"
        osRunCb(git_command,
          function(ret_ary){
            out_str = sRed(git_command) + " " + ret_ary.length + '<br/>'
            out_str += "<table>"
            for (var ind in ret_ary) {

                var line = ret_ary[ind].trim()
                line_ary = line.match(/(\d+ )(.*$)/)

                class_str =""
                if (ind <= 20) class_str = 'class="s120"'
                if (ind <= 10) class_str = 'class="s150"'

                out_str += '<tr><td ' + class_str + '>' + sSilver((parseInt(ind) + 1 )) + '</td>' +
                              '<td ' + class_str + '><span onClick="makePaneLog(\'' + line_ary[2] + '\')" class="btn">' + matchRed(line_ary[2],filter) + '</span></td>' +
                              '<td ' + class_str + '>' + line_ary[1] + '</td></tr>'
            }
            out_str += '<table>'
            $('#pane_user_detail').html(out_str)
            openPaneCenter('pane_user');
            $('#filter_user').focus()
          }
        )
    }

    makePaneFilelist = function(filter,base_command){

        $('#pane_filelist_detail').html('')
        $('#pane_filelist_detail_r').html('')

        //ファイル検索
        var git_command = 'git ls-files '
        if (base_command) git_command = base_command

        if (filter) git_command += " | egrep -i '" + filter + "'"
        git_command += ' | head -1000'
        osRunCb(git_command,
          function( ret_ary){

              $('#pane_filelist_detail_r').append(sRed(escapeHTML(git_command)) + " " + sGray(ret_ary.length) + '<br/>')
              var str_out =""
              for (var ind in ret_ary){
                  str_out += '<a onClick="fileStat(\'' + ret_ary[ind].trim() + '\')" href="javascript:void(0);" >' + matchRed(ret_ary[ind],filter) + '</a><br/>'
              }
              $('#pane_filelist_detail_r').append(str_out )

              openPaneCenter('pane_filelist');
              $('#filter_filelist').focus()
        })


        //スラッシュのないもの

        //拡張子でまとめ



        //dir 1階層でまとめ
        var com1 = "git ls-files | egrep -i '\/' | perl -ple 's/(.*?\\/)(.*)/$1/' | sort | uniq -c | head -100"
        //com1 = "git ls-files | egrep -i '\/' | sort | uniq -c | head -10"
        console.log(com1)
        var str_out1 = ""
        var str_out2 = ""
        var writeLeftPane = function(){
            if (str_out1 && str_out2) $('#pane_filelist_detail').append(str_out1 + str_out2 )
        }

        osRunCb(com1,
          function( ret_ary){
              console.log('str_out1',ret_ary)
              str_out1 ="<table>"
              for (var ind in ret_ary){
                  var ary = ret_ary[ind].trim().split(/\s+/)
                  str_out1 += '<tr><td> <a onClick="fileStat(\'' + ary[1].trim() + '\')" href="javascript:void(0);" >' + matchRed(ary[1],filter) + '</a> </td><td> ' + ary[0] + ' </td></tr>'
              }
              str_out1 +="</table>"
              writeLeftPane()
          }
        )

        //dir 2階層でまとめ
        var com2 = "git ls-files | egrep -i '\\/.*\\/' | perl -ple 's/(.*?\\/.*?\\/)(.*)/$1/' | sort | uniq -c"
        osRunCb(com2,
          function( ret_ary){
            str_out2 = "<table>"
            for (var ind in ret_ary){
                var ary = ret_ary[ind].trim().split(/\s+/)
                str_out2 += '<tr><td> <a onClick="fileStat(\'' + ary[1].trim() + '\')" href="javascript:void(0);" >' + matchRed(ary[1],filter) + '</a> </td><td> ' + ary[0] + ' </td></tr>'
            }
            str_out2 +="</table>"
            writeLeftPane()
          }
        )
    }

    fileStat = function(filepath){

      $('#pane_file_detail_1').html("")
      $('#pane_file_detail_2').html("")

      var git_command = 'git log --oneline --follow --name-status --date=short --pretty=format:" %ad %h  %an %s " '  + filepath.trim()
      osRunCb(git_command,
        function(ret_ary){
          console.log('retary',ret_ary)

          var htmlstr = s150(sBold(filepath)) + '<br/>'
          htmlstr += sRed(escapeHTML(git_command)) + " " + sGray(ret_ary.length) + '<br/>'
          var str_out = ret_ary.join('<br/>')
          $('#pane_file_detail_1').append( htmlstr + str_out + '<br/><br/>')
      })

      var git_command2 = 'git log -p --oneline --pretty=format:" %ad %x09 %h %x09 %an %x09 %s" '  + filepath.trim()
      osRunCb(git_command2,
        function(ret_ary){
          var htmlstr = s150(sBold('diff')) + '<br/>' +
                       sRed(escapeHTML(git_command2)) + " " + sGray(ret_ary.length) + '<br/>'
          for (var ind in ret_ary){
            ret_ary[ind] = escapeHTML(ret_ary[ind]).replace(/ /,'&nbsp;')
          //  str_out += '<a onClick="fileStat(\'' + ret_ary[ind].trim() + '\')" href="javascript:void(0);" >' + ret_ary[ind].replace(new RegExp('(' + filter.trim() + ')','ig'),sRed('$1') ) + '</a><br/>'
          }
          ret_ary = diffColor(ret_ary)

          var str_out2 = ret_ary.join('<br/>')
          $('#pane_file_detail_2').append( htmlstr + str_out2 )

          openPaneCenter('pane_file');
      })


    }

    makePaneLog = function( filter ){
         var git_command = 'git log --date=relative --pretty=format:"<tr><td nowrap > %ad %x09 %h %x09 %an %x09 %s </td></tr>"'

        $('#filter_log').val(filter) // 引数で来たフィルターもテキストボックスにセット

         filter_ary = filter.trim().split(/\s+/)
         for (var ind in filter_ary){
            git_command += " | egrep -i '" + filter_ary[ind] + "'"
         }
         git_command += ' | head -1000'

         osRunCb(git_command,
           function(ret_ary){
             $('#pane_log_detail').html('')
             $('#pane_log_detail').append(sRed(escapeHTML(git_command)) + " " + sGray(ret_ary.length) + '<br/>')
             var str_out = ret_ary.join('')
             str_out = str_out.replace(/\t/g,'</td><td nowrap >')
             for (var ind in filter_ary){
                if (!filter_ary[ind]) continue;
                str_out = str_out.replace(new RegExp('(' + filter_ary[ind].trim() + ')','ig'),sRed('$1') )
             }
            $('#pane_log_detail').append('<table>' + str_out + '</table>')
            openPaneCenter('pane_log');
            $('#filter_log').focus()
         })
     }

     makePaneStatus = function(){

         osRunOut('git status -s -b','pane_status_detail')

         $('#pane_status_detail').html('')
         var com2 = 'git diff --cached #最後のcommitと現在変更してstageしたものの違い'
         osRunCb(com2,
           function(ret_ary){
             for (var ind in ret_ary){
               ret_ary[ind] = escapeHTML(ret_ary[ind]).replace(/ /,'&nbsp;')
             }
             ret_ary = diffColor(ret_ary)
             var ret_out_str = ret_ary.join('<br/>')
             $('#pane_status_detail').append('<br/>' + sRed(escapeHTML(com2)) + " " + sGray(ret_ary.length) + '<br/>' + ret_out_str )
           }
         )

//aaaa

         var com3 = 'git diff #addした後の再変更'
         osRunCb(com3,
           function(ret_ary){
             for (var ind in ret_ary){
               ret_ary[ind] = escapeHTML(ret_ary[ind]).replace(/ /,'&nbsp;')
             }
             ret_ary = diffColor(ret_ary)
             var ret_out_str = ret_ary.join('<br/>')

             $('#pane_status_detail').append('<br/>' + sRed(escapeHTML(com3)) + " " + sGray(ret_ary.length) + '<br/>' + ret_out_str )
           }
         )
         openPaneCenter('pane_status');
     }



    //初期処理
    osRunOneLine('git version', 'version')
    osRunOneLine('node -v', 'node_version')

    var git_command1 = 'node -v'
    osRunCb(git_command1, function(ret_ary){
      $('#nodejs_info').append(sRed(git_command1) + '<br/>' + ret_ary.join('<br/>') + '<br/>')
    })
    var git_command2 = 'npm -g list'
    osRunCb( git_command2, function(ret_ary){
      $('#nodejs_info').append(sRed(git_command2) + '<br/>' + ret_ary.join('<br/>') + '<br/>')
    })
    osRunCb('npm -g list', 'nodejs_info')

    var com2 = 'git config --global --list'
    osRunCb( com2 ,
      function(ret_ary){
        for (var ind in ret_ary ){
            if (ret_ary[ind].match(/(name|email)/)) $('#g_user').append(ret_ary[ind].replace(/.*=/,'') + ' &nbsp; ')
        }
        $('#gitconf').append( sRed(com2) + '<br/>' + ret_ary.join('<br/>').replace(/ /g,'&nbsp;') + '<br/>' )
      })
    osrun('cat ~/.gitignore_global','gitconf')
    findLocalRepos()


    const {ipcRenderer} = require('electron')
    toggleDevTools = function(){  ipcRenderer.send('ipcDevTool', 'ping')   }
    toggleFullScreen = function(){  ipcRenderer.send('ipcFullScreen', 'ping')   }


    // keyevent

    //enterなら候補1に確定、それ以外ならキー押すごとに検索
    $('#filter_l_repo').keyup(function(e){
        if (e.which == 13 && top_filtered_repo) {
          setRepoPath( top_filtered_repo )
          return ;
        }
        filterLocalRepos($('#filter_l_repo').val())
    })

    $('#filter_filelist').keyup(function(e){
        if (e.which == 13) makePaneFilelist( $('#filter_filelist').val() )
    })
    $('#filter_log').keyup(function(e){
        if (e.which == 13) makePaneLog( $('#filter_log').val() )
    })
    $('#filter_user').keyup(function(e){
        if (e.which == 13) makePaneUser( $('#filter_user').val() )
    })



    </script>
</html>
